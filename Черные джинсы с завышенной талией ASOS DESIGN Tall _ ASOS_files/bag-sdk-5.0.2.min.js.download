define("bagsdk/global",[],function(){return window}),define("bagsdk/utils/getInstanceEventBus",["jquery"],function(t){return"function"==typeof t?t({}):void 0}),define("bagsdk/utils/sdkInstanceAsyncLoader",["bagsdk/utils/getInstanceEventBus"],function(t){var e={};return e.load=function(e,n,r,i){return i.isBuild?void r(e):(t.bagSdkInstantiated&&r(e),void t.on("bagSdk:instanceReady",function(){r(e)}))},e}),define("Asos.Commerce.Bag.Sdk",["bagsdk/global","bagsdk/utils/sdkInstanceAsyncLoader!dummyModuleName"],function(t){var e=["asos","commerce","_bagSdkInstance"].reduce(function(t,e){return"undefined"!=typeof t?t[e]:void 0},t);return e}),define("bagsdk/config/configuration",[],function(){return{}}),define("bagsdk/config/defaultConfiguration",["bagsdk/global"],function(t){var e="https://"+t.location.hostname+"/bag/gateway/",n="https://"+t.location.hostname+"/api",r="http://"+t.location.hostname+"/api";return{postMessageUrl:e,bagApiUrl:n,paymentOptionsApiUrl:n,productCatalogueApiUrl:r,subscriptionOptionsApiUrl:n,xSiteOrigin:null}}),define("bagsdk/config/currencies",[],function(){return{"COM:GBP":"£0.00","COM:USD":"$0.00","COM:CAD":"C$0.00","COM:SEK":"SEK0.00","COM:NOK":"NOK0.00","COM:DKK":"DKK0.00","COM:CHF":"CHF0.00","COM:EUR":"€0.00","COM:AUD":"$0.00","COM:RMB":"¥0.00","COM:HKD":"HKD$0.00","COM:NZD":"NZD$0.00","COM:SGD":"SGD$0.00","COM:TWD":"NT$0.00","COM:RUB":"руб. 0.00","US:GBP":"£0.00","US:USD":"$0.00","US:CAD":"C$0.00","US:SEK":"SEK0.00","US:NOK":"NOK0.00","US:DKK":"DKK0.00","US:CHF":"CHF0.00","US:EUR":"€0.00","US:AUD":"$0.00","US:RMB":"¥0.00","US:HKD":"HKD$0.00","US:NZD":"NZD$0.00","US:SGD":"SGD$0.00","US:TWD":"NT$0.00","US:RUB":"руб. 0.00","FR:GBP":"0,00 £","FR:USD":"0,00 $","FR:CAD":"0,00 C$","FR:SEK":"0,00 SEK","FR:NOK":"0,00 NOK","FR:DKK":"0,00 DKK","FR:CHF":"0,00 CHF","FR:EUR":"0,00 €","FR:AUD":"0,00 $","FR:RMB":"0,00 ¥","FR:HKD":"0,00 HKD$","FR:NZD":"0,00 NZD$","FR:SGD":"0,00 SGD$","FR:TWD":"0,00 NT$","FR:RUB":"0,00 руб.","DE:GBP":"0,00 £","DE:USD":"0,00 $","DE:CAD":"0,00 C$","DE:SEK":"0,00 SEK","DE:NOK":"0,00 NOK","DE:DKK":"0,00 DKK","DE:CHF":"0,00 CHF","DE:EUR":"0,00 €","DE:AUD":"0,00 $","DE:RMB":"0,00 ¥","DE:HKD":"0,00 HKD$","DE:NZD":"0,00 NZD$","DE:SGD":"0,00 SGD$","DE:TWD":"0,00 NT$","DE:RUB":"0,00 руб.","IT:GBP":"£ 0,00","IT:USD":"$ 0,00","IT:CAD":"C$ 0,00","IT:SEK":"SEK 0,00","IT:NOK":"NOK 0,00","IT:DKK":"DKK 0,00","IT:CHF":"CHF 0,00","IT:EUR":"€ 0,00","IT:AUD":"$ 0,00","IT:RMB":"¥ 0,00","IT:HKD":"HKD$ 0,00","IT:NZD":"NZD$ 0,00","IT:SGD":"SGD$ 0,00","IT:TWD":"NT$ 0,00","IT:RUB":"руб. 0,00","ES:GBP":"0,00 £","ES:USD":"0,00 $","ES:CAD":"0,00 C$","ES:SEK":"0,00 SEK","ES:NOK":"0,00 NOK","ES:DKK":"0,00 DKK","ES:CHF":"0,00 CHF","ES:EUR":"0,00 €","ES:AUD":"0,00 $","ES:RMB":"0,00 ¥","ES:HKD":"0,00 HKD$","ES:NZD":"0,00 NZD$","ES:SGD":"0,00 SGD$","ES:TWD":"0,00 NT$","ES:RUB":"0,00 руб.","AU:GBP":"£0.00","AU:USD":"$0.00","AU:CAD":"C$0.00","AU:SEK":"SEK0.00","AU:NOK":"NOK0.00","AU:DKK":"DKK0.00","AU:CHF":"CHF0.00","AU:EUR":"€0.00","AU:AUD":"$0.00","AU:RMB":"¥0.00","AU:HKD":"HKD$0.00","AU:NZD":"NZD$0.00","AU:SGD":"SGD$0.00","AU:TWD":"NT$0.00","AU:RUB":"руб. 0.00","RU:GBP":"0,00£","RU:USD":"0,00$","RU:CAD":"0,00C$","RU:SEK":"0,00SEK","RU:NOK":"0,00NOK","RU:DKK":"0,00DKK","RU:CHF":"0,00CHF","RU:EUR":"0,00€","RU:AUD":"0,00$","RU:RMB":"0,00¥","RU:HKD":"0,00HKD$","RU:NZD":"0,00NZD$","RU:SGD":"0,00SGD$","RU:TWD":"0,00NT$","RU:RUB":"0,00 руб."}}),define("bagsdk/models/SimpleXhrResponseWrapper",[],function(){function t(t,e,n){this.responseText=t||"",this.status=e,this._responseHeaders=this._parseHeaders(n)}return t.prototype._parseHeaders=function(t){var e={};if(!t||"string"!=typeof t)return e;for(var n,r,i,o=t.split("\r\n"),a=": ",s=o.length;s--;)o[s].indexOf(a)>0&&(i=o[s].split(a),n=i[0],r=i[1],e[n]=r);return e},t.prototype.getResponseHeader=function(t){return this._responseHeaders.hasOwnProperty(t)?this._responseHeaders[t]:null},t}),define("bagsdk/models/apiService",["jquery","uuid","bagsdk/config/configuration","bagsdk/global","bagsdk/models/SimpleXhrResponseWrapper"],function(t,e,n,r,i){function o(e){if(this.defaultOptions={contentType:"application/json",dataType:"json",headers:{"asos-c-plat":"Web","asos-c-name":"Asos.Commerce.Bag.Sdk","asos-c-ver":"5.0.2","asos-c-istablet":!1,"asos-c-ismobile":!1}},t.extend(!0,this.defaultOptions,e),!this.isCorsSupported()){var i=r.document.createElement("a");i.href=n.postMessageUrl,this.gatewayOrigin=i.protocol+"//"+i.hostname,u(i)||(this.gatewayOrigin+=":"+i.port),this.postMessageInitiator="BagSdk",a=t('iframe[src="'+n.postMessageUrl+'"]'),0===a.length&&(a=t("<iframe>").attr("src",n.postMessageUrl).appendTo(r.document.body).css("display","none")),s=a.get(0).contentWindow,r.addEventListener?r.addEventListener("message",this.postMessageTransportEventHandler.bind(this),!1):r.attachEvent&&r.attachEvent("onmessage",this.postMessageTransportEventHandler.bind(this))}}var a,s,c=0,u=function(t){return"https:"===t.protocol&&"443"===t.port||"http:"===t.protocol&&"80"===t.port},d=function(t){return null===t||void 0===t?"":t.join(":::")},h=function(t){return t=t||"",t.split(":::")};return o.prototype.isCorsSupported=function(){return"XMLHttpRequest"in r&&"withCredentials"in new XMLHttpRequest},o.prototype.setupRequestAjaxOptions=function(r,i,o){return r=t.extend(!0,{url:"",headers:{"asos-cid":e()}},this.defaultOptions,r||{}),n.xSiteOrigin&&i.withParam("x-site-origin",n.xSiteOrigin),r.type=i.method.toUpperCase(),r.url+=i.path,"object"==typeof o&&Object.keys(o).length&&(r.data=JSON.stringify(o)),r},o.prototype.successfulResponseHandler=function(t){return t},o.prototype.failedResponseHandler=function(t){var e="",n=t.getResponseHeader("content-type")||t.getResponseHeader("Content-Type");return 401===t.status||403===t.status?[{errorCode:"BagDoesNotExist"}]:n&&-1!==n.indexOf("json")?JSON.parse(t.responseText):n&&-1!==n.indexOf("plain")&&t.responseText?t.responseText:e},o.prototype.jQueryTransport=function(e){return new Promise(function(n,r){t.ajax(e).done(function(){n(this.successfulResponseHandler.apply(this,arguments))}.bind(this)).fail(function(){r(this.failedResponseHandler.apply(this,arguments))}.bind(this))}.bind(this))},o.prototype.postMessageTransport=function(e){return new Promise(function(n,r){function i(e,i,o){t(this).off(d(["postMessageResolution",e])),o.success?n(this.successfulResponseHandler.call(this,o.data,"success",o.response)):r(this.failedResponseHandler.call(this,o.response))}t(this).on(d(["postMessageResolution",c]),i.bind(this,c));var o=d([c,this.postMessageInitiator,JSON.stringify(e)]);this.postMessageSend(o),c++}.bind(this))},o.prototype.postMessageSend=function(e){s?s.postMessage(e,n.postMessageUrl):t(a).on("load",function(){s=a.get(0).contentWindow,s.postMessage(e,n.postMessageUrl)})},o.prototype.postMessageTransportEventHandler=function(e){if(e.origin===this.gatewayOrigin){var n,r,o,a=h(e.data),s=parseInt(a[0],10),c=parseInt(a[1],10),u=a[2];if(u!==this.postMessageInitiator)return;try{n=JSON.parse(a[3]),r=a[4],o=parseInt(a[5],10)}catch(p){n=""}var g=new i(a[3],o,r);t(this).trigger(d(["postMessageResolution",s]),{data:n,success:c,response:g})}},o.prototype.request=function(t,e,n){var i=this.setupRequestAjaxOptions(n,t,e),o=r.document.createElement("a");o.href=i.url;var a=o.hostname===r.location.hostname,s=o.protocol===r.location.protocol,c=i.url&&i.url.length&&"/"===i.url[0];return r.newrelic&&r.newrelic.interaction().save(),c||a&&s||this.isCorsSupported()?this.jQueryTransport(i):this.postMessageTransport(i)},o}),define("bagsdk/services/identityService",["require","asos.identity.events","asos.identity.sdk.supportedEventTypes"],function(t,e,n){var r=function(){return new Promise(function(e){t(["Asos.Identity.Web.ClientSdk"],function(t){e(t)})})};return{customerGuid:function(){return r().then(function(t){return t.customer.customerGuid()})},customerId:function(){return r().then(function(t){return t.customer.customerId()})},getAccessToken:function(){return r().then(function(t){return t.getAccessToken()})},onSessionEnded:function(t){e.subscribe(n.onSessionEnded,t)},onLoggedIn:function(t){e.subscribe(n.onLoggedIn,t)},persistentId:function(){return r().then(function(t){return t.ready().then(function(e){return t.customer.profile().then(function(n){return"undefined"==typeof n||n.isAnonymous?t.customer.customerGuid():n.customerAid||e._oidcTokenManager._token.profile.aid})})})}}}),define("bagsdk/exceptions/bagSdkException",[],function(){function t(t,e){return Array.isArray(t)?t.some(function(t){return t.errorCode===e}):!1}function e(e){this.name="BagSdkException",this.message=e,this.stack=(new Error).stack,this.bagStateInvalid=t(e,"BagItemDoesNotExist")||t(e,"ProductNotAvailableFromProductService")}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}),define("bagsdk/factories/memoryCacheFactory",[],function(){function t(t){this.storage=t}var e={};return t.prototype.getItem=function(t){var e,n=this.storage[t];return n&&(n.expires>(new Date).getTime()||!n.expires?e=n.value:(delete this.storage[t],e=null)),e},t.prototype.removeItem=function(t){this.storage[t]&&delete this.storage[t]},t.prototype.setItem=function(t,e,n){var r=1e3*n||0;this.storage[t]={value:e,expires:r?(new Date).getTime()+r:r}},t.prototype.clear=function(){this.storage={}},function(){return{application:new t(e),instance:new t({})}}}),define("global",[],function(){return window}),define("bagsdk/services/persistedDataService",["global"],function(t){function e(t){this.storage=t,this.storageKey="Asos.Commerce.Bag.Sdk",this.cleanCache()}return e.prototype.cleanCache=function(){var t=this.getStorageItem(),e={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.hasOwnProperty("expires")&&r.expires>(new Date).getTime()&&(e[n]=r)}this._setStorageItem(this.storageKey,JSON.stringify(e))},e.prototype.getStorageItem=function(){var t=this.storage.getItem(this.storageKey);return t?JSON.parse(t):{}},e.prototype.getItem=function(t){var e=this.getStorageItem();if(e.hasOwnProperty(t)){var n=e[t];if(n.expires>(new Date).getTime())return n.data;this.deleteItem(t)}return null},e.prototype.setItem=function(t,e,n){n="undefined"==typeof n?36e5:n;var r=this.getStorageItem();r[t]={data:e,expires:(new Date).getTime()+n},this._setStorageItem(this.storageKey,JSON.stringify(r))},e.prototype.deleteItem=function(t){var e=this.getStorageItem();delete e[t],this._setStorageItem(this.storageKey,JSON.stringify(e))},e.prototype.clear=function(){this._setStorageItem(this.storageKey,JSON.stringify({}))},e.prototype._setStorageItem=function(e,n){try{this.storage.setItem(e,n)}catch(r){t.console.warn("Error setting localStorage:",r)}},new e(t.localStorage)}),define("bagsdk/services/cookieService",["bagsdk/global","jquery"],function(t,e){function n(){return new Date}function r(){var e=new RegExp(/(?:.)*?\.?asos(.+)/),n=t.location.hostname.replace(e,"asos$1");return n}function i(e,i,o){var a=r(),s="";if(o){var c=n();c.setTime(c.getTime()+24*o*60*60*1e3),s="; expires="+c.toGMTString()}t.document.cookie=e+"="+i+s+";path=/;domain="+a}var o=function(t,n,r){var i={};if(t)for(var o=t.split(n),a=0;a<o.length;a++){var s=o[a].indexOf(r);i[e.trim(o[a].substr(0,s))]=o[a].substr(s+1)}return i},a=function(t,e,n){var r=[];for(var i in t)t.hasOwnProperty(i)&&r.push(i+n+t[i]);return r.join(e)},s=function(e){var n=o(t.document.cookie,";","="),r="";return e in n&&(r=n[e]),decodeURIComponent(r)},c=function(t){var e=s(t);return o(e,"&","=")};return{readCookie:s,writeToCookie:function(t,e,n,r){var o=c(t);o[e]=encodeURIComponent(n);var s=a(o,"&","=");i(t,s,r)},writeCookie:function(t,e,n){i(t,e,n)},getCookieDomain:r,getDate:n,invalidateCookieByPrefix:function(e){var n=t.document.cookie.split(/;\s*/),r=n.filter(function(t){return t.match(e+"[^=]*=")});r.forEach(function(t){var e=t.split("=")[0];this.writeCookie(e,"null",-1)}.bind(this))}}}),define("bagsdk/services/bagApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException","bagsdk/factories/memoryCacheFactory","bagsdk/services/persistedDataService","bagsdk/services/cookieService"],function(t,e,n,r,i,o){function a(e,n){t.call(this,{url:n}),this.memoryCache=r(),this.keyCreator=e;var a=null,s=null;this.setBagId=function(t){var e=this.keyCreator.createCookieKey("BagId");a=t,o.writeCookie(e,t,2/24)},this.readLastModifiedCookie=function(){var t=this.keyCreator.createCookieKey("BagLastModified"),e=parseInt(o.readCookie(t),10);return isNaN(e)?null:e},this.setLastModifiedCookie=function(t,e){var n=this.keyCreator.createCookieKey("BagLastModified");s=t,o.writeCookie(n,t,e)},this.updatePersistedLastModified=function(t){var e=this.keyCreator.createPersistedDataKey({persistentId:t,keyName:"bagLastModified"}),n=Date.now();i.setItem(e,n),this.setLastModifiedCookie(n,1/24)},this.getBagId=function(){return a},this.setOrigin=function(t){o.writeCookie("BagOrigin",t,2/24)},this.getOrigin=function(){return o.readCookie("BagOrigin")||null}}var s=20;return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype.setupRequestAjaxOptions=function(){var e=t.prototype.setupRequestAjaxOptions.apply(this,arguments),n=this.getOrigin();return n&&(e.headers=e.headers||{},e.headers["asos-bag-origin"]=n),e},a.prototype.successfulResponseHandler=function(t,e,n){var r;return r=t.bag&&t.bag.origin?t.bag.origin:n.getResponseHeader("asos-bag-origin"),r&&this.setOrigin(r),t.bag&&t.bag.id?this.setBagId(t.bag.id):t.bagId&&this.setBagId(t.bagId),t},a.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new n(t):new Error(t)},a.prototype.request=function(n,r){return Promise.all([e.getAccessToken(),e.persistentId()]).then(function(e){function a(t){o.writeToCookie("asosbasket","basketitemcount",t.totalQuantity,1/24),o.writeToCookie("asosbasket","basketitemtotalretailprice",t.totalPrice?t.totalPrice.value:void 0,1/24)}var c=e[0],u=e[1],d={headers:{Authorization:"bearer "+c}};return t.prototype.request.call(this,n,r,d).then(function(t){t=t||{};var e=t.bag?t.bag.summary:t,n=t.bag?!0:!1;if(a(e),n){var r=this.keyCreator.createMemoryCacheKey({keyName:"bag"});this.memoryCache.application.setItem(r,t,s)}var o=this.keyCreator.createPersistedDataKey({persistentId:u,keyName:"summary"}),c=this.keyCreator.createPersistedDataKey({persistentId:u,keyName:"bagId"});return i.setItem(o,e,3e5),i.setItem(c,e.bagId,72e5),this.updatePersistedLastModified(u),t}.bind(this))}.bind(this))["catch"](this.exceptionHandler.bind(this))},a}),define("bagsdk/adaptors/summaryVariantsToVariantSizesAdaptor",[],function(){function t(){}return t.prototype.adapt=function(t){return t.sort(function(t,e){return t.sizeOrder-e.sizeOrder}).map(function(t){return{variantId:t.id,price:t.price.current.text,size:t.brandSize,inStock:t.isInStock}})},new t}),define("bagsdk/adaptors/summaryVariantsToProductColoursAdaptor",[],function(){function t(){}return t.prototype.adapt=function(t){return t.sort(function(t,e){return t.colour.localeCompare(e.colour)}).map(function(t){return{price:t.price,colour:t.colour,colourCode:t.colourCode,image:t.image}})},new t}),define("bagsdk/services/productCatalogueApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException","bagsdk/adaptors/summaryVariantsToVariantSizesAdaptor","bagsdk/adaptors/summaryVariantsToProductColoursAdaptor"],function(t,e,n,r,i){function o(e){t.call(this,{url:e})}function a(t){return function(e){return e.filter(function(e){var n=!1;return e.hasOwnProperty("colourCode")&&(n=e.colourCode===t),n||(n=e.colour===t),n})}}function s(t){return t.filter(function(t){return t.isInStock===!0})}function c(){var t={};return function(e){return e.filter(function(e){return t.hasOwnProperty(e.colour)?!1:(t[e.colour]=!0,!0)})}}function u(t){return r.adapt(t)}function d(t){return i.adapt(t)}function h(t){var e={};t.images.filter(function(t){return"Standard"===t.type}).forEach(function(t){e[t.colour]=t.url}),t.variants.forEach(function(t){t.image=e[t.colour]})}function p(t){return t.variants}function g(t){return h(t),p(t)}function m(t){if(!Array.isArray(t)||0===t.length)throw new Error("Invalid server response");return t[0]}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new n(t):new Error(t)},o.prototype.request=function(n,r){return e.getAccessToken().then(function(e){var i={headers:{Authorization:"bearer "+e}};return t.prototype.request.call(this,n,r,i)}.bind(this))["catch"](this.exceptionHandler.bind(this))},o.prototype.requestVariantSizes=function(t,e){return this.request(t).then(m).then(p).then(a(e)).then(u)},o.prototype.requestProductColours=function(t){return this.request(t).then(m).then(g).then(s).then(c()).then(d)},o}),define("bagsdk/config/routes",[],function(){return{commerceBag:{createBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/bags/getbag",method:"post"},getBagByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag",method:"get"},getBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag",method:"get"},getBagSummaryByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag/total",method:"get"},getBagSummaryByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag/total",method:"get"},getBagById:{path:"/commerce/bag/v4/bags/:bagId",method:"get"},getBagSummaryById:{path:"/commerce/bag/v4/bags/:bagId/total",method:"get"},addVariant:{path:"/commerce/bag/v4/bags/:bagId/product",method:"post"},addVariants:{path:"/commerce/bag/v4/bags/:bagId/products",method:"post"},removeItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId",method:"delete"},removeSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription/:itemId",method:"delete"},removeVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"delete"},updateItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId",method:"patch"},moveToBag:{path:"/commerce/bag/v4/bags/:bagId/products/save",method:"post"},saveBag:{path:"/commerce/bag/v4/bags/:bagId/items/save",method:"post"},saveBagItem:{path:"/commerce/bag/v4/bags/:bagId/items/:itemId/save",method:"post"},updateCurrency:{path:"/commerce/bag/v4/bags/:bagId/currency",method:"put"},setDeliveryOption:{path:"/commerce/bag/v4/bags/:bagId/deliveryoptions",method:"put"},addVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers",method:"post"},updateVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"put"},addSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription",method:"post"}},productCatalog:{getProductSummary:{path:"/product/catalogue/v2/summaries/",method:"get"}},paymentOptions:{getPaymentMethods:{path:"/finance/paymentoptions/v2/paymentmethods/klarnaNordics",method:"get"}},subscriptionOptions:{getSubscriptionOptions:{path:"/commerce/subscriptionsoptions/v1/subscriptions",method:"get"}}}}),define("bagsdk/models/route",["bagsdk/global"],function(t){function e(t,e){this.path=t,this.method=e}return e.prototype.withExpansions=function(e){function n(e,n){if(e+=-1===e.indexOf("?")?"?":"&",e+="expand=",Array.isArray(n)){for(var r=0;r<n.length-1;r++)e+=t.escape(n[r])+",";e+=t.escape(n[n.length-1])}else e+=t.escape(n);return e}return this.path=n(this.path,e),this},e.prototype.withParam=function(e,n){function r(e,n,r){return e+=-1===e.indexOf("?")?"?":"&",e+=t.escape(n)+"="+t.escape(r)}return this.path=r(this.path,e,n),this},e}),define("bagsdk/services/routeService",["bagsdk/config/routes","bagsdk/models/route"],function(t,e){function n(e){var n=o;if(e&&e.routeCollection){if(!t[e.routeCollection])throw new Error('Unknown routeCollection "'+e.routeCollection+'".');n=t[e.routeCollection]}return n}function r(t,e){var n,r=t;for(var i in e)e.hasOwnProperty(i)&&(n=new RegExp(":"+i,"g"),r=r.replace(n,e[i]));return r}function i(t,i,o){var a=n(o),s=a[t];if(!s)throw new Error('Unknown route "'+t+'".');return new e(r(s.path,i),s.method)}var o=t.commerceBag;return{createRoute:i}}),define("bagsdk/services/paymentOptionsService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException"],function(t,e,n){function r(e){t.call(this,{url:e})}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new n(t):new Error(t)},r.prototype.getPaymentMethods=function(n){return e.getAccessToken().then(function(e){var r={headers:{Authorization:"bearer "+e}};return t.prototype.request.call(this,n,void 0,r)}.bind(this))["catch"](this.exceptionHandler.bind(this))},r}),define("bagsdk/services/subscriptionOptionsService",["bagsdk/models/apiService","bagsdk/exceptions/bagSdkException"],function(t,e){function n(e){t.call(this,{url:e})}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new e(t):new Error(t)},n.prototype.getSubscriptionOptions=function(e){var n={};return t.prototype.request.call(this,e,void 0,n)["catch"](this.exceptionHandler.bind(this))},n}),define("bagsdk/services/notificationService",["jquery"],function(t){function e(e,n,r){t(e).trigger(n,r)}function n(){}var r="addToBag:",i="bagUpdated:",o="bagSdk:",a={addEventStart:r+"started",addEventCompleted:r+"completed",addEventError:r+"error",updateEventCompleted:i+"completed",customerLogoutEvent:o+"customerLogout"};return n.prototype.notifyItemAddedToBagStart=function(t,n){e(t,a.addEventStart,n)},n.prototype.notifyItemAddedToBagComplete=function(t,n){e(t,a.addEventCompleted,n)},n.prototype.notifyItemAddedToBagError=function(t,n){e(t,a.addEventError,n)},n.prototype.notifyBagUpdatedComplete=function(t,n,r){e(t,a.updateEventCompleted,[n,r])},new n}),define("bagsdk/utils/comparer",[],function(){var t=function(t,e){var n=Object.keys(t),r=Object.keys(e);return n.length!==r.length?!1:n.every(function(n){return t[n]===e[n]})},e=function(e,n){return t(e,n)},n=function(e,n){return t(e,n)};return{areConfigurationsEqual:e,areContextsEqual:n}}),define("bagsdk/utils/keyCreator",[],function(){function t(t,e,n){this._storeId=t,this._country=e,this._enableStoreBaseOperation=n}var e=function(t){return t.join(":::")};return t.prototype.createMemoryCacheKey=function(t){var n=[];return this._enableStoreBaseOperation||n.push(this._storeId),n.push(this._country),n.push(t.keyName),e(n)},t.prototype.createPersistedDataKey=function(t){var n=[];return n.push(t.persistentId),n.push(this._storeId),this._enableStoreBaseOperation||n.push(this._country),n.push(t.keyName),e(n)},t.prototype.createCookieKey=function(t){var e=[];return e.push(t),e.push(this._storeId),this._enableStoreBaseOperation||e.push(this._country),e.join(":")},t}),define("bagsdk/exceptions/bagSdkSingleInstanceMismatchError",["./bagSdkException"],function(t){function e(){this.name="BagSdkSingleInstanceMismatchError",this.stack=(new Error).stack}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}),define("bagsdk/exceptions/argumentError",["./bagSdkException"],function(t){function e(t){this.name="ArgumentError",this.message=t,this.stack=(new Error).stack}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}),define("bagSdk/sdk",["bagsdk/config/configuration","bagsdk/config/defaultConfiguration","bagsdk/config/currencies","bagsdk/services/bagApiService","bagsdk/factories/memoryCacheFactory","bagsdk/services/cookieService","bagsdk/services/productCatalogueApiService","bagsdk/services/identityService","bagsdk/services/routeService","bagsdk/services/persistedDataService","bagsdk/services/paymentOptionsService","bagsdk/services/subscriptionOptionsService","bagsdk/services/notificationService","bagsdk/utils/comparer","bagsdk/utils/keyCreator","bagsdk/utils/getInstanceEventBus","bagsdk/global","jquery","bagsdk/exceptions/bagSdkException","bagsdk/exceptions/bagSdkSingleInstanceMismatchError","bagsdk/exceptions/argumentError"],function(t,e,n,r,i,o,a,s,c,u,d,h,p,g,m,f,l,y,b,v,S){function I(t){var e=[w.summary,w.total];return void 0!==t&&(e=e.concat(t)),e}function C(e){this._context=e,this._keyCreator=new m(e.storeId,e.country,e.enableStoreBasedOperation),this._bagApiService=new r(this._keyCreator,t.bagApiUrl),this._paymentOptionsService=new d(t.paymentOptionsApiUrl),this._subscriptionOptionsService=new h(t.subscriptionOptionsApiUrl),this._productCatalogueApiService=new a(t.productCatalogueApiUrl),this._memoryCache=i(),this._bindEventSubscriptions(),this._bagIdCookieKey=this._keyCreator.createCookieKey("BagId"),this._bagOriginCookieKey="BagOrigin",this._lastModifiedCookieKey=this._keyCreator.createCookieKey("BagLastModified"),this._keyStoreDataVersionKey="asos-b-sdv629",this._googleAnalyticsClientIdCookieName="asos-b-gat251",this._existingDataVersionCookie=o.readCookie(this._keyStoreDataVersionKey),this._computeKeyStoreDataVersion()}function k(t){return"RMB"===t?"CNY":t}function _(t,e){var n=o.readCookie(t),r=o.readCookie(e);return!(!n||!r||"null"===n||"null"===r)}function B(t,e){var n=o.readCookie(t),r=o.readCookie(e),i=!!n&&"null"!==n,a=!!r&&"null"!==r,s="StartCheckout:CookieCheckFailed";return i||a?i&&!a?s="StartCheckout:MissingBagOrigin":!i&&a&&(s="StartCheckout:MissingBagId"):s="StartCheckout:MissingBagOriginAndId",s}function D(t,e,n){return new Promise(function(r,i){var o=this._context.currency;e!==o?this.updateCurrency(o,n).then(function(t){r(t)})["catch"](function(t){i(t)}):r(t)}.bind(this))}function E(t){return Promise.resolve(t&&t.bag&&t.bag.summary?t.bag.summary:t)}var w={deliveryOptions:"getdeliveryoptions",summary:"summary",total:"total",variants:"variants"};C.prototype._expansions=w,C.prototype._bindEventSubscriptions=function(){s.onSessionEnded(this._handleLogout.bind(this)),s.onLoggedIn(this._handleLogin.bind(this))},C.prototype._getUniqueUrlValue=function(){return(new Date).getTime()},C.prototype.version="5.0.2",C.prototype._init=function(){return Promise.all([s.customerGuid(),s.persistentId(),s.customerId()]).then(function(t){var e={customerGuid:t[0],persistentId:t[1],customerId:t[2]},n=this._keyCreator.createPersistedDataKey({persistentId:e.persistentId,keyName:"bagId"}),r=u.getItem(n);return r||(r=o.readCookie(this._bagIdCookieKey)||null),e.bagId=r,e}.bind(this))},C.prototype._prepareBag=function(t){return new Promise(function(e,n){return null===t.bagId?this._createBag().then(function(n){t.bagId=n.bag.id,e(t)})["catch"](function(t){n(t)}):void e(t)}.bind(this))},C.prototype.getCustomerConfig=function(){return new Promise(function(t){t({country:this._context.originCountry,currency:this._context.currency})}.bind(this))},C.prototype._getCurrencyNillValueByStoreAndCurrencyCode=function(t,e){t=t||"",e=e||"";var r=[t,e].join(":");return n.hasOwnProperty(r)?n[r]:"0.00"},C.prototype._bagDoesNotExist=function(t){return!!(t&&"object"==typeof t&&Array.isArray(t.message)&&t.message.filter(function(t){return"BagDoesNotExist"===t.errorCode||"BagDoesNotExistForCustomer"===t.errorCode}).length)},C.prototype._handleBagDoesNotExist=function(t,e){e&&this._bagDoesNotExist(t)&&this._invalidateCachesAndCookies(e)},C.prototype._invalidateCaches=function(t){["summary","bagId","bagLastModified","isLoggedIn"].forEach(function(e){var n=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:e});u.deleteItem(n)}.bind(this))},C.prototype._invalidateCachesAndCookies=function(t){t?this._invalidateCaches(t):u.clear(),o.invalidateCookieByPrefix("BagId"),o.invalidateCookieByPrefix("BagLastModified"),o.invalidateCookieByPrefix("BagOrigin")},C.prototype.getOrCreateBag=function(t){return this.getBag()["catch"](function(e){if(this._bagDoesNotExist(e))return this._createBag(t);throw e}.bind(this))},C.prototype.getBag=function(t){var e=this._memoryCache.application.getItem(this._keyCreator.createMemoryCacheKey({keyName:"bag"}));return e?new Promise(function(t){t(e)}):this._init().then(function(e){if(null!==e.bagId)return this._getBagById(e.bagId,t,e.persistentId);var n=e.customerId||e.customerGuid;return this._getBagByCustomerId(n,t,e.persistentId)}.bind(this))},C.prototype.getBagById=function(t,e){return this._init().then(function(n){return this._getBagById(t,e,n.persistentId)}.bind(this))},C.prototype._getBagById=function(t,e,n){var r=c.createRoute("getBagById",{bagId:t}).withExpansions(I(e)).withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue());return this._bagApiService.request(r).then(this._validateBagCurrency.bind(this,e)).then(function(t){return p.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n),t}.bind(this))},C.prototype.getBagByCustomer=function(t){return this._init().then(function(e){var n=e.customerId||e.customerGuid;return this._getBagByCustomerId(n,t,e.persistentId)}.bind(this))},C.prototype._getBagByCustomerId=function(t,e,n){var r=this._constructGetBagByCustomerIdRoute(t,e);return this._bagApiService.request(r).then(this._validateBagCurrency.bind(this,e)).then(function(t){return p.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n),t}.bind(this))},C.prototype._constructGetBagByCustomerIdRoute=function(t,e){var n;return n=this._context.enableStoreBasedOperation?c.createRoute("getBagByCustomerAndStore",{guid:t,store:this._context.storeId}):c.createRoute("getBagByCustomer",{guid:t,country:this._context.country}).withParam("keyStoreDataversion",this._context.keyStoreDataversion),n.withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()).withExpansions(I(e))},C.prototype._createBag=function(t){return this._init().then(function(e){var n={currency:this._context.currency,lang:this._context.language,sizeSchema:this._context.sizeSchema},r=c.createRoute("createBagByCustomer",{guid:e.customerId||e.customerGuid}).withExpansions(I(t)).withParam("lang",this._context.language);return this._context.enableStoreBasedOperation?(n.country=this._context.originCountry,n.store=this._context.storeId):(r.withParam("keyStoreDataversion",this._context.keyStoreDataversion),n.country=this._context.country,n.originCountry=this._context.originCountry),this._bagApiService.request(r,n)}.bind(this))},C.prototype._getCachedSummary=function(t){if(this._bagModified(t))return null;var e=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"summary"});return u.getItem(e)},C.prototype._getCachedLastModified=function(t){var e=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"bagLastModified"});return u.getItem(e)},C.prototype.getNillBagSummary=function(t){return{bagId:null,currency:t,totalPrice:{text:this._getCurrencyNillValueByStoreAndCurrencyCode(this._context.storeId,t),value:0},totalQuantity:0}},C.prototype._bagModified=function(t){var e=this._getCachedLastModified(t),n=this._bagApiService.readLastModifiedCookie();return e!==n},C.prototype.getBagSummary=function(){var t=function(t){var e;if(null!==t.bagId)e=c.createRoute("getBagSummaryById",{bagId:t.bagId});else{var n={guid:t.customerId||t.customerGuid};this._context.enableStoreBasedOperation===!0?(n.store=this._context.storeId,e=c.createRoute("getBagSummaryByCustomerAndStore",n)):(n.country=this._context.country,e=c.createRoute("getBagSummaryByCustomer",n),e.withParam("keyStoreDataversion",this._context.keyStoreDataversion))}return e.withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()),e};return this._init().then(function(e){var n=this._getCachedSummary(e.persistentId);if(n&&n.bagId===e.bagId)return n;var r=t.call(this,e);return this._bagApiService.request(r)["catch"](function(t){this._handleBagDoesNotExist(t,e.persistentId);var n=this.getNillBagSummary(this._context.currency),r=this._keyCreator.createPersistedDataKey({persistentId:e.persistentId,keyName:"summary"});return u.setItem(r,n),n}.bind(this))}.bind(this)).then(this._validateBagSummaryCurrency.bind(this))};var x=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){var r=c.createRoute("addVariant",{bagId:n.bagId}).withExpansions(I(e)).withParam("lang",this._context.language),i={
variantId:t};return this._bagApiService.request(r,i).then(function(t){return p.notifyItemAddedToBagComplete(this,t),p.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))};C.prototype.addVariant=function(t,e){return new Promise(function(n,r){p.notifyItemAddedToBagStart(this,t.variantId);var i=x.bind(this,t.variantId,e);i().then(n)["catch"](function(t){this._bagDoesNotExist(t)?i().then(n)["catch"](function(t){p.notifyItemAddedToBagError(this,t),r(t)}):(p.notifyItemAddedToBagError(this,t),r(t))}.bind(this))}.bind(this))};var A=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){var r=c.createRoute("addVariants",{bagId:n.bagId}).withExpansions(I(e)).withParam("lang",this._context.language);return this._bagApiService.request(r,t).then(function(t){return p.notifyItemAddedToBagComplete(this,t),p.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))};C.prototype.addVariants=function(t,e){return new Promise(function(n,r){var i=t.map(function(t){return{variantId:t.variantId}});p.notifyItemAddedToBagStart(this,t);var o=A.bind(this,i,e);o().then(n)["catch"](function(t){this._bagDoesNotExist(t)?o().then(n)["catch"](function(t){p.notifyItemAddedToBagError(this,t),r(t)}):(p.notifyItemAddedToBagError(this,t),r(t))}.bind(this))}.bind(this))},C.prototype.removeItem=function(t,e,n){return this._init().then(this._prepareBag.bind(this)).then(function(r){var i;switch(e){case"subscription":i="removeSubscription";break;case"voucher":i="removeVoucher";break;default:i="removeItem"}var o=c.createRoute(i,{bagId:r.bagId,itemId:t}).withExpansions(I(n)).withParam("lang",this._context.language);return this._bagApiService.request(o).then(function(t){return p.notifyBagUpdatedComplete(this,"removeItem",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,r.persistentId),t}.bind(this))}.bind(this))},C.prototype.updateItem=function(t,e,n,r){return this._init().then(this._prepareBag.bind(this)).then(function(i){var o={bagId:i.bagId,itemId:t},a=c.createRoute("updateItem",o).withExpansions(I(r)).withParam("lang",this._context.language);return this._bagApiService.request(a,{quantity:n,variantId:e}).then(function(t){return p.notifyBagUpdatedComplete(this,"updateItem",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,i.persistentId),t}.bind(this))}.bind(this))};var O=function(t,e,n){return this._init().then(this._prepareBag.bind(this)).then(function(r){var i=c.createRoute("moveToBag",{bagId:r.bagId}).withExpansions(I(n)).withParam("lang",this._context.language),o=[{variantId:t}];return isNaN(parseInt(e,10))||(o[0].savedItemId=parseInt(e,10)),p.notifyItemAddedToBagStart(this,t),this._bagApiService.request(i,o).then(function(t){return p.notifyItemAddedToBagComplete(this,t),p.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,r.persistentId),t}.bind(this))}.bind(this))};C.prototype.moveToBag=function(t,e,n){return new Promise(function(r,i){p.notifyItemAddedToBagStart(this,t);var o=O.bind(this,t,e,n);o().then(r)["catch"](function(t){this._bagDoesNotExist(t)?o().then(r)["catch"](function(t){p.notifyItemAddedToBagError(this,t),i(t)}):(p.notifyItemAddedToBagError(this,t),i(t))}.bind(this))}.bind(this))},C.prototype.saveBag=function(t){return this._init().then(this._prepareBag.bind(this)).then(function(e){var n={bagId:e.bagId},r=c.createRoute("saveBag",n).withExpansions(I(t)).withParam("lang",this._context.language);return this._bagApiService.request(r).then(function(t){return p.notifyBagUpdatedComplete(this,"saveBag",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))},C.prototype.saveForLater=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){var r={bagId:n.bagId,itemId:t},i=c.createRoute("saveBagItem",r).withExpansions(I(e)).withParam("lang",this._context.language);return this._bagApiService.request(i).then(function(t){return p.notifyBagUpdatedComplete(this,"saveForLater",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))},C.prototype._computeKeyStoreDataVersion=function(){var t=this._context.keyStoreDataversion||"NO_KEY_STORE_DATAVERSION",e=.25;this._existingDataVersionCookie!==t&&this._invalidateCachesAndCookies(),o.writeCookie(this._keyStoreDataVersionKey,t,e)},C.prototype._getProductSummaryRoute=function(t){var e=c.createRoute("getProductSummary",{},{routeCollection:"productCatalog"}).withParam("productids",t).withParam("store",this._context.storeId).withParam("currency",this._context.currency).withParam("lang",this._context.language).withParam("sizeSchema",this._context.sizeSchema).withExpansions(w.variants);return this._context.keyStoreDataversion&&e.withParam("keyStoreDataversion",this._context.keyStoreDataversion),e},C.prototype.getSizes=function(t,e){var n=this._getProductSummaryRoute(t);return this._productCatalogueApiService.requestVariantSizes(n,e)},C.prototype.getColours=function(t){var e=this._getProductSummaryRoute(t);return this._productCatalogueApiService.requestProductColours(e)},C.prototype.updateCurrency=function(t,e){return this._init().then(function(n){if(!n.bagId)return new Promise(function(e){var r=this.getNillBagSummary(t),i=this._keyCreator.createPersistedDataKey({persistentId:n.persistentId,keyName:"summary"});u.setItem(i,r),this._context.currency=t,e(null)}.bind(this));var r={bagId:n.bagId},i=c.createRoute("updateCurrency",r).withExpansions(I(e)).withParam("lang",this._context.language),o=k(t);return this._bagApiService.request(i,{currency:o}).then(function(t){return this._context.currency=o,p.notifyBagUpdatedComplete(this,"updateCurrency",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))},C.prototype.setDeliveryOption=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){var r={bagId:n.bagId},i=c.createRoute("setDeliveryOption",r).withExpansions(w.deliveryOptions).withParam("lang",this._context.language),o={deliveryOptionId:t};return void 0!==e&&(o.nominatedDate=e),this._bagApiService.request(i,o).then(function(t){return p.notifyBagUpdatedComplete(this,"setDeliveryOption",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))};var K=function(t,e,n,r,i,o,a){return this._init().then(this._prepareBag.bind(this)).then(function(s){var u={bagId:s.bagId},d=c.createRoute("addVoucher",u).withExpansions(I(a)).withParam("lang",this._context.language),h={Value:t,ToName:e,ToEmail:n,VoucherStyleId:r,DeliveryDate:i};return o&&(o.fromName&&(h.FromName=o.fromName),o.personalMessage&&(h.PersonalMessage=o.personalMessage)),this._bagApiService.request(d,h).then(function(t){return p.notifyBagUpdatedComplete(this,"addVoucher",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,s.persistentId),t}.bind(this))}.bind(this))};C.prototype.addVoucher=function(t,e,n,r,i,o,a){return new Promise(function(s,c){var u=K.bind(this,t,e,n,r,i,o,a);u().then(s)["catch"](function(t){this._bagDoesNotExist(t)?u().then(s)["catch"](c):c(t)}.bind(this))}.bind(this))},C.prototype.updateVoucher=function(t,e,n,r,i,o,a,s){return this._init().then(this._prepareBag.bind(this)).then(function(u){var d={bagId:u.bagId,itemId:t},h=c.createRoute("updateVoucher",d).withExpansions(I(s)).withParam("lang",this._context.language),g={Value:e,ToName:n,ToEmail:r,VoucherStyleId:i,DeliveryDate:o};return a&&(a.fromName&&(g.FromName=a.fromName),a.personalMessage&&(g.PersonalMessage=a.personalMessage)),this._bagApiService.request(h,g).then(function(t){return p.notifyBagUpdatedComplete(this,"updateVoucher",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,u.persistentId),t}.bind(this))}.bind(this))};var U=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){var r={bagId:n.bagId},i=c.createRoute("addSubscription",r).withExpansions(I(e)).withParam("lang",this._context.language);return this._bagApiService.request(i,{SubscriptionId:t}).then(function(t){return p.notifyBagUpdatedComplete(this,"addSubscription",t),t}.bind(this))["catch"](function(t){throw this._handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))};C.prototype.addSubscription=function(t,e){return new Promise(function(n,r){var i=U.bind(this,t,e);i().then(n)["catch"](function(t){this._bagDoesNotExist(t)?i().then(n)["catch"](r):r(t)}.bind(this))}.bind(this))},C.prototype.getPaymentMethods=function(t){var e=c.createRoute("getPaymentMethods",{},{routeCollection:"paymentOptions"}).withParam("lang",this._context.language).withParam("billingCountry",t||this._context.originCountry).withParam("currency",this._context.currency);return this._paymentOptionsService.getPaymentMethods(e)},C.prototype.getSubscriptionOptions=function(t){var e=c.createRoute("getSubscriptionOptions",{},{routeCollection:"subscriptionOptions"}).withParam("country",t||this._context.originCountry).withParam("store",this._context.storeId).withParam("currency",this._context.currency).withParam("lang",this._context.language);return this._subscriptionOptionsService.getSubscriptionOptions(e)},C.prototype._saveGoogleAnalyticsClientId=function(){return l.ga&&l.ga(function(t){var e=t.get("clientId");o.writeCookie(this._googleAnalyticsClientIdCookieName,e)}.bind(this)),!0},C.prototype.startCheckout=function(){return new Promise(function(t,e){this._init().then(this._ensureCheckoutValues.bind(this)).then(function(t){this._invalidateCaches(t.persistentId)}.bind(this)).then(this._saveGoogleAnalyticsClientId.bind(this)).then(t.bind(this))["catch"](e)}.bind(this))},C.prototype._ensureCheckoutValues=function(t){return new Promise(function(e,n){_(this._bagIdCookieKey,this._bagOriginCookieKey)?e(t):this.getBag().then(function(){if(_(this._bagIdCookieKey,this._bagOriginCookieKey))e(t);else{var r=B(this._bagIdCookieKey,this._bagOriginCookieKey);n(new Error(r))}}.bind(this))["catch"](function(t){var e="";"object"==typeof t&&Array.isArray(t.message)&&t.message.length>0&&(e=":"+t.message[0].errorCode),n(new Error("StartCheckout:GetBagFailed"+e))})}.bind(this))},C.prototype._getUserBagOrReplaceBag=function(t){var e,n=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"summary"}),r=u.getItem(n);return e=r?!r.bagId:!0,e?(this._invalidateCachesAndCookies(),this.getBagSummary()):this.getBagById(r.bagId)},C.prototype._handleLogin=function(){return s.persistentId().then(function(t){var e=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"isLoggedIn"}),n=u.getItem(e);return u.setItem(e,!0,3600),n?Promise.resolve():this._getUserBagOrReplaceBag(t)}.bind(this))},C.prototype._handleLogout=function(){this._memoryCache.application.clear(),this._invalidateCachesAndCookies(),o.writeCookie(this._keyStoreDataVersionKey,"null",-1)},C.prototype._validateBagCurrency=function(t,e){return D.call(this,e,e.bag.currency,t)},C.prototype._validateBagSummaryCurrency=function(t){return this._init().then(function(e){return D.call(this,t,t.currency).then(E).then(function(t){return null===t?this._getCachedSummary(e.persistentId):t}.bind(this))}.bind(this))},l.asos=l.asos||{},l.asos.commerce=l.asos.commerce||{};var N=null,R=function(t){for(var e in t)null===t[e]&&delete t[e]},P=function(t){if(!t)throw new S("context is required");if(t.enableStoreBasedOperation===!0){if(t.keyStoreDataversion)throw new S("invalid use of context.keyStoreDataversion")}else if(!t.keyStoreDataversion)throw new S("context.keyStoreDataversion is required");["storeId","country","originCountry","currency","language","sizeSchema"].forEach(function(e){if(!t[e])throw new S("context."+e+" is required")})};return l.asos.commerce.bagSdk={getInstance:function(n,r){P(n);var i=y.extend({},n,{currency:k(n.currency)});if(N){var o=y.extend({},r);if(R(o),o=y.extend({},e,o),g.areContextsEqual(i,N._context)&&g.areConfigurationsEqual(o,t))return N;throw new v}return y.extend(t,e,r),N=new C(i),l.asos.commerce._bagSdkInstance=N,f.trigger("bagSdk:instanceReady"),f.bagSdkInstantiated=!0,N}},l.asos.commerce.bagSdk});